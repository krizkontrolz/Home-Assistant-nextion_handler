# 2) Dynamic Round Sliders on Nextion Devices

The [first tips and tricks page](/Tips_and_Tricks/NEXTION_GESTURES.md) showed different ways of implementing gestures on Nextion devices.  The realtime touch information on the 'swipe and press' gestures page of the demo HMI file started to give some idea of the opportunities for being more creative in using that data during touch events.

Here, as examples to illustrate some of that potential, are two implementations of a **round/circular slider** that use that information in different ways.
Both examples are included on a single page in the demo HMI file in this folder, and you press the button next to the slider to toggle between the different `Timer`s used to process the gestures.  The 'swipe and press' gestures from the the previous page are also implemented on the circular sliders page (so `tc0` selects which gesture processor to use based on which UI component is initially touched).  You can get a good feeling for how these sliders work by using the HMI file in the Nextion Editor simulator.  The main differences when using this on a physical device are: **1)** the slider might be a bit small for your use case (although you can get very fine control by using the whole screen once you have started the round slider - you don't have to keep your finger on the visible arc); **2)** there will be some screen flicker on the physical device and you need to take some steps to reduce this (to demonstrate this the first 'progressive arc' approach described below only updates UI elements when a step change in value occurs, while 'moving dot' implementation updates whever touch movement is detected).

## Progressive arc slider
[Uses: `ATAN2`, `xpic`]  
The 'progressive' slider uses an [arctan](/Tips_and_Tricks/GEOMETRIC_FUNCTIONS.md#atan2) function (of the current touch coordinates relative to the centre of the slider arc) to determine which part of the round slider scale the current touch location should be associated with.  It then divides the slider scale value (0 – 9999) up into steps and uses the current 'step' value to select which of a series of slider images to crop, using the Nextion `xpic` instruction, to visualise slider movements.  This method allows the greatest control over the style of the visual feedback on the circular slider, but requires a separate image to be created for each 'step' in slider value to be visually represented (although the returned slider scale value can be returned with greater precision/fine steps).  Note that the slider scale (0 – 9999) has much more precision than the series of stepped images in the `xpic` series, so some UI design decisions have to made about the extent to which the precision of the final returned valued is matched to the precision that is visually portrayed on the slider.

On the slider testing page in the demo HMI file, the 'Gesture info' table (on the left) shows the realtime touch information for 'normal' gestures (where touches start off the sliders).  The 'Round Slider' table (on the right) shows the realtime touch coordinates for round slider interactions (`x`, `y`) and the deltas from the centre of the slider arc (`dx`, `dy`).  The current slider scale arctan `val` (0 – 9999) is also shown, together with which octant (numbered 1..8 clockwise from 3 o'clock) and quadrant (A..D: from pairs of octants 1&8, 2&3, 4&5, 6&7 respectively, based on the symmetry of arctan relative to the first π/4 octant) is currently being used in the [arctan](/Tips_and_Tricks/GEOMETRIC_FUNCTIONS.md#atan2) subroutine.

![Edge swipe demo page](/Tips_and_Tricks/images/ROUND-SLIDER_Progressive-Anim.gif)

## Moving dot slider
[Uses: `ATAN2`, `SQRT`, `cirs`]  
The 'moving dot' approach is more fucntionally versatile, but more restricted in visual representation/customisation.  It uses a static slider background on which a dot is drawn to represent the scale position for the current touch location.  As above it uses an [arctan](/Tips_and_Tricks/GEOMETRIC_FUNCTIONS.md#atan2) function (of the current touch coordinates relative to the centre of the slider arc) to determine the slider scale value (0 – 9999).  The visualisation uses a [square root](/Tips_and_Tricks/GEOMETRIC_FUNCTIONS.md#sqrt) function to rescale the current touch location distance from the centre of the slider arc back onto the radius of the visual arc, and then draws a filled circle there with the Nextion `cirs` instruction.  As before, the calculation and precision of the returned slider scale value is separate from its visual represenation.  It is a UI design decision to determine how many visual steps are used (to reduce screen flicker) and to what extent the visual steps reflect how the slider scale value is applied to step changes in the final returned value (e.g. the temperature in the middle of the slider).  To illustrate this issue in the included demo HMI file, the graphical updates for the 'moving dot' are done whenever movement is detected, giving very fine resolution feedback at the expense of screen flicker (whereas for the 'progressive slider' approach, graphical updates are only given for coarse step changes).  The Nextion Editor simulator does _not_ show screen flicker issues - those need to be tested and optimised on a physical device.)

On the slider testing page in the demo HMI file, realtime information is given on touch events as they are processed.  When the 'moving dot slider' is in use, the 'Round Slider' table (on the right) shows the realtime touch coordinates for round slider interactions (`x`, `y`) and the deltas from the centre of the slider arc (`dx`, `dy`) and the current slider scale arctan value (0 – 9999 range), while the 'Gesture info' table (on the left) is used to show post-processed touch coordinates _after they have been radially rescaled back onto the round slider arc_.

![Edge swipe demo page](/Tips_and_Tricks/images/ROUND-SLIDER_Moving-Dot-Anim.gif)

(Todo: COS/SIN fuctions for updating dot location when the value is changed from somewhere other than the slider.)

## Geometric function approximations
The details of the geometric function subroutines used in the round sliders are covered in the next [tips and tricks page](/Tips_and_Tricks/GEOMETRIC_FUNCTIONS.md).
